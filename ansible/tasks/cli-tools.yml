---
- name: Check if lazygit is installed
  stat:
    path: "{{ ansible_env.HOME }}/.local/bin/lazygit"
  register: lazygit_check

- name: Get latest lazygit version
  uri:
    url: https://api.github.com/repos/jesseduffield/lazygit/releases/latest
    return_content: yes
  register: lazygit_release
  when: not lazygit_check.stat.exists

- name: Install lazygit
  unarchive:
    src: "https://github.com/jesseduffield/lazygit/releases/download/{{ lazygit_release.json.tag_name }}/lazygit_{{ lazygit_release.json.tag_name | regex_replace('^v', '') }}_Linux_x86_64.tar.gz"
    dest: "{{ ansible_env.HOME }}/.local/bin"
    remote_src: yes
    include:
      - lazygit
  when: not lazygit_check.stat.exists

- name: Check if lazydocker is installed
  stat:
    path: "{{ ansible_env.HOME }}/.local/bin/lazydocker"
  register: lazydocker_check

- name: Get latest lazydocker version
  uri:
    url: https://api.github.com/repos/jesseduffield/lazydocker/releases/latest
    return_content: yes
  register: lazydocker_release
  when: not lazydocker_check.stat.exists

- name: Install lazydocker
  unarchive:
    src: "https://github.com/jesseduffield/lazydocker/releases/download/{{ lazydocker_release.json.tag_name }}/lazydocker_{{ lazydocker_release.json.tag_name | regex_replace('^v', '') }}_Linux_x86_64.tar.gz"
    dest: "{{ ansible_env.HOME }}/.local/bin"
    remote_src: yes
    include:
      - lazydocker
  when: not lazydocker_check.stat.exists

- name: Check if bun is installed
  stat:
    path: "{{ ansible_env.HOME }}/.bun/bin/bun"
  register: bun_check

- name: Install bun
  shell: curl -fsSL https://bun.sh/install | bash
  args:
    creates: "{{ ansible_env.HOME }}/.bun/bin/bun"
  when: not bun_check.stat.exists

- name: Check if heroku is installed
  shell: "{{ ansible_env.HOME }}/.local/bin/mise exec node -- npm list -g heroku"
  register: heroku_check
  ignore_errors: yes
  changed_when: false

- name: Install Heroku CLI via npm
  shell: "{{ ansible_env.HOME }}/.local/bin/mise exec node -- npm install -g heroku"
  when: heroku_check.rc != 0
  environment:
    PATH: "{{ ansible_env.HOME }}/.local/bin:{{ ansible_env.PATH }}"
