---
- name: Add 1Password GPG key
  become: true
  ansible.builtin.rpm_key:
    key: https://downloads.1password.com/linux/keys/1password.asc
    state: present

- name: Add 1Password repository
  become: true
  ansible.builtin.yum_repository:
    name: 1password
    description: 1Password Stable Channel
    baseurl: https://downloads.1password.com/linux/rpm/stable/$basearch
    gpgcheck: true
    gpgkey: https://downloads.1password.com/linux/keys/1password.asc
    repo_gpgcheck: true
    enabled: true

- name: Install base packages via rpm-ostree
  become: true
  community.general.rpm_ostree_pkg:
    name:
      # Core tools
      - git
      - git-lfs
      - vim-enhanced
      - stow
      - fzf
      - bash-completion
      - tig
      - tree
      - unzip
      - jq
      - gh
      - ShellCheck
      # 1Password
      - 1password-cli
      - 1password
      # Build tools
      - gcc
      - gcc-c++
      - make
      - openssl-devel
      - readline-devel
      - zlib-devel
      - libyaml-devel
      - libffi-devel
      - gdbm-devel
      - ncurses-devel
      - pkg-config
      - autoconf
      - bison
      - clang
      # Image processing
      - vips
      - vips-devel
      - ImageMagick
      - ImageMagick-devel
      # Database clients
      - postgresql
      - libpq-devel
      - redis
      - sqlite
      - sqlite-devel
      - mysql-devel
      # Container
      - podman-docker
    state: present
  register: rpm_ostree_result

- name: Notify about reboot requirement
  debug:
    msg: "rpm-ostree packages installed. A reboot is required to apply changes."
  when: rpm_ostree_result.changed
